# MTR Telegram Bot

使用MTR路径导航器的Telegram机器人。

## 安装依赖

```bash
pip install -r requirements.txt
```

## 配置

1. 复制 `.env.example` 为 `.env`
2. 在 `.env` 中设置你的 Telegram Bot Token

## 运行

```bash
python telegram_bot.py
```

## 使用方法

### 基本查询

在Telegram中发送 `/path` 命令，然后按照提示输入起点和终点车站名称。

### 历史记录

- `/history` - 查看最近10条查询历史
- 点击历史记录中的按钮可以快速重新查询

### 车站信息

- `/station <车站名>` - 查询车站详情
- 显示经过该车站的所有路线
- 显示换乘信息

### 线路信息

- `/line <线路名>` - 查询线路详情
- 显示线路名称、编号、类型
- 显示经过该线路的所有车站

### 搜索

- `/search <关键词>` - 搜索车站或线路
- 支持模糊匹配
- 显示前10个结果

### 快捷命令

- `/addroute` - 添加快捷命令
  - 按照提示输入命令名称、起点和终点
- `/route` - 查看所有快捷命令列表
- `/route <命令名>` - 使用快捷命令查询
  - 例如：`/route home`
- `/delroute` - 删除快捷命令
  - 从列表中选择要删除的快捷命令

### 设置

- `/settings` - 打开设置面板
  - 详细模式：显示每站的到站、出发时间
  - 高铁：是否包含高铁路线
  - 船：是否包含船运路线
  - 越野步行：是否允许非出站换乘（越野）
  - 仅轻轨：只查询轻轨路线
  - 最大时长：设置最大查询时长（1-12小时）
  - 最小时长：设置最小查询时长（0-12小时）
  - 最大换乘：设置最大换乘次数（0-20次）
  - 优先快速：优先选择快速路线
  - 优先少换乘：优先选择换乘次数少的路线
  - 时区：设置时区（UTC-12到UTC+12）
  - 地图链接：是否使用自定义地图链接
  - 重置默认设置：恢复初始配置

### 地图设置

- `/setmap` - 设置自定义地图链接
  - 按照提示输入新的地图链接
  - 默认链接：http://leonmmcoset.jjxmm.win:8888
- `/seemap` - 查看当前地图链接
  - 显示当前使用的地图链接
  - 显示是默认链接还是自定义链接

### 其他

- `/start` - 显示帮助信息
- `/cancel` - 取消当前操作

## 功能说明

- 每个用户的设置和快捷命令独立保存
- 查询历史自动记录最近10条
- 所有用户数据会持久化保存到 `user_data.json` 文件，重启服务器后不会丢失
- 生成的图片会自动保存到 `mtr-pathfinder/pngs` 文件夹中
- 所有操作都会记录到 `bot.log` 日志文件，方便调试和监控
